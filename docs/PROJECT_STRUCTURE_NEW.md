# é¡¹ç›®ç»“æ„è¯´æ˜

## ğŸ“ ç›®å½•ç»“æ„

```
modbus-rtu-manager/
â”œâ”€â”€ src/                          # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ server.js                 # ä¸»æœåŠ¡å™¨æ–‡ä»¶
â”‚   â”œâ”€â”€ modbusManager.js          # Modbus è®¾å¤‡ç®¡ç†å™¨
â”‚   â”œâ”€â”€ database.js               # æ•°æ®åº“ä¸»æ–‡ä»¶
â”‚   â”œâ”€â”€ alarm/                    # å‘Šè­¦æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ AlarmManager.js       # å‘Šè­¦ç®¡ç†å™¨
â”‚   â”‚   â””â”€â”€ NotificationManager.js # é€šçŸ¥ç®¡ç†å™¨
â”‚   â”œâ”€â”€ backup/                   # å¤‡ä»½æ¨¡å—
â”‚   â”‚   â””â”€â”€ BackupManager.js      # å¤‡ä»½ç®¡ç†å™¨
â”‚   â”œâ”€â”€ cluster/                  # é›†ç¾¤æ¨¡å—
â”‚   â”‚   â””â”€â”€ ClusterManager.js     # é›†ç¾¤ç®¡ç†å™¨
â”‚   â”œâ”€â”€ config/                   # é…ç½®æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ cluster.config.js     # é›†ç¾¤é…ç½®
â”‚   â”‚   â”œâ”€â”€ database.config.js    # æ•°æ®åº“é…ç½®
â”‚   â”‚   â””â”€â”€ system.config.js      # ç³»ç»Ÿé…ç½®
â”‚   â”œâ”€â”€ database/                 # æ•°æ®åº“é€‚é…å™¨
â”‚   â”‚   â”œâ”€â”€ index.js              # æ•°æ®åº“å…¥å£
â”‚   â”‚   â””â”€â”€ adapters/             # å„ç§æ•°æ®åº“é€‚é…å™¨
â”‚   â”‚       â”œâ”€â”€ sqlite.js         # SQLite é€‚é…å™¨
â”‚   â”‚       â”œâ”€â”€ mysql.js          # MySQL é€‚é…å™¨
â”‚   â”‚       â”œâ”€â”€ postgres.js       # PostgreSQL é€‚é…å™¨
â”‚   â”‚       â””â”€â”€ redis.js          # Redis é€‚é…å™¨
â”‚   â”œâ”€â”€ monitoring/               # ç›‘æ§æ¨¡å—
â”‚   â”‚   â””â”€â”€ PrometheusExporter.js # Prometheus å¯¼å‡ºå™¨
â”‚   â”œâ”€â”€ time/                     # æ—¶é—´åŒæ­¥æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ TimeSync.js           # æ—¶é—´åŒæ­¥
â”‚   â”‚   â”œâ”€â”€ TimeSyncMonitor.js    # æ—¶é—´åŒæ­¥ç›‘æ§
â”‚   â”‚   â””â”€â”€ NTPServer.js          # NTP æœåŠ¡å™¨
â”‚   â””â”€â”€ tools/                    # å·¥å…·æ¨¡å—
â”‚       â””â”€â”€ ModbusDeviceInitializer.js # è®¾å¤‡åˆå§‹åŒ–å·¥å…·
â”‚
â”œâ”€â”€ public/                       # å‰ç«¯é™æ€æ–‡ä»¶
â”‚   â”œâ”€â”€ index.html                # ä¸»é¡µé¢
â”‚   â”œâ”€â”€ app.js                    # å‰ç«¯ JavaScript
â”‚   â”œâ”€â”€ style.css                 # æ ·å¼æ–‡ä»¶
â”‚   â”œâ”€â”€ device-initializer.html   # è®¾å¤‡åˆå§‹åŒ–é¡µé¢
â”‚   â”œâ”€â”€ images/                   # å›¾ç‰‡èµ„æº
â”‚   â””â”€â”€ uploads/                  # ä¸Šä¼ æ–‡ä»¶ç›®å½•
â”‚
â”œâ”€â”€ docs/                         # æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ README.md                 # æ–‡æ¡£ç´¢å¼•
â”‚   â”œâ”€â”€ guides/                   # è¯¦ç»†æŒ‡å—
â”‚   â”‚   â”œâ”€â”€ LOCATION_GUIDE.md     # ä½ç½®ç®¡ç†æŒ‡å—
â”‚   â”‚   â”œâ”€â”€ ALARM_GUIDE.md        # å‘Šè­¦ç®¡ç†æŒ‡å—
â”‚   â”‚   â”œâ”€â”€ BACKUP_GUIDE.md       # å¤‡ä»½ç®¡ç†æŒ‡å—
â”‚   â”‚   â”œâ”€â”€ CLUSTER_GUIDE.md      # é›†ç¾¤ç®¡ç†æŒ‡å—
â”‚   â”‚   â””â”€â”€ ...                   # å…¶ä»–æŒ‡å—
â”‚   â””â”€â”€ quickstart/               # å¿«é€Ÿå¼€å§‹
â”‚       â””â”€â”€ ...
â”‚
â”œâ”€â”€ scripts/                      # è„šæœ¬æ–‡ä»¶
â”‚   â”œâ”€â”€ windows/                  # Windows è„šæœ¬
â”‚   â”‚   â”œâ”€â”€ install-service.bat   # å®‰è£…æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ install-service.js    # æœåŠ¡å®‰è£…è„šæœ¬
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ linux/                    # Linux è„šæœ¬
â”‚   â”‚   â”œâ”€â”€ install-service.sh    # å®‰è£…æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ install-raspberry-pi.sh # æ ‘è“æ´¾å®‰è£…
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ backup.sh                 # å¤‡ä»½è„šæœ¬
â”‚   â”œâ”€â”€ restore.sh                # æ¢å¤è„šæœ¬
â”‚   â””â”€â”€ switch-database.js        # æ•°æ®åº“åˆ‡æ¢å·¥å…·
â”‚
â”œâ”€â”€ backups/                      # å¤‡ä»½æ–‡ä»¶ç›®å½•ï¼ˆè¿è¡Œæ—¶ç”Ÿæˆï¼‰
â”‚   â”œâ”€â”€ config_backup_*.json      # é…ç½®å¤‡ä»½
â”‚   â””â”€â”€ sqlite_backup_*.db        # æ•°æ®åº“å¤‡ä»½
â”‚
â”œâ”€â”€ node_modules/                 # Node.js ä¾èµ–ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”‚
â”œâ”€â”€ .env.example                  # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ .env.notification.example     # é€šçŸ¥é…ç½®ç¤ºä¾‹
â”œâ”€â”€ .gitignore                    # Git å¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ .dockerignore                 # Docker å¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ package.json                  # é¡¹ç›®é…ç½®
â”œâ”€â”€ package-lock.json             # ä¾èµ–é”å®šæ–‡ä»¶
â”œâ”€â”€ Dockerfile                    # Docker é•œåƒé…ç½®
â”œâ”€â”€ docker-compose.yml            # Docker Compose é…ç½®
â”œâ”€â”€ docker-compose.simple.yml     # ç®€åŒ–ç‰ˆ Docker Compose
â”œâ”€â”€ Makefile                      # Make å‘½ä»¤é…ç½®
â”œâ”€â”€ install.bat                   # Windows å®‰è£…è„šæœ¬
â”œâ”€â”€ install.sh                    # Linux å®‰è£…è„šæœ¬
â”œâ”€â”€ start-temp.bat                # ä¸´æ—¶å¯åŠ¨è„šæœ¬
â”œâ”€â”€ prometheus.yml                # Prometheus é…ç½®
â”œâ”€â”€ prometheus_rules.yml          # Prometheus å‘Šè­¦è§„åˆ™
â”œâ”€â”€ modbus.db                     # SQLite æ•°æ®åº“ï¼ˆè¿è¡Œæ—¶ç”Ÿæˆï¼‰
â””â”€â”€ README.md                     # é¡¹ç›®è¯´æ˜æ–‡æ¡£
```

## ğŸ“ æ ¸å¿ƒæ–‡ä»¶è¯´æ˜

### æºä»£ç  (src/)

#### ä¸»æ–‡ä»¶
- **server.js**: Express æœåŠ¡å™¨ä¸»æ–‡ä»¶ï¼Œå¤„ç† HTTP è¯·æ±‚å’Œ WebSocket è¿æ¥
- **modbusManager.js**: Modbus è®¾å¤‡ç®¡ç†æ ¸å¿ƒï¼Œè´Ÿè´£è®¾å¤‡é€šä¿¡å’Œæ•°æ®é‡‡é›†
- **database.js**: æ•°æ®åº“æ“ä½œå°è£…ï¼Œæä¾›ç»Ÿä¸€çš„æ•°æ®è®¿é—®æ¥å£

#### æ¨¡å—ç›®å½•

**alarm/** - å‘Šè­¦ç³»ç»Ÿ
- å®æ—¶ç›‘æ§è®¾å¤‡çŠ¶æ€
- å¤šç§å‘Šè­¦è§„åˆ™ï¼ˆé˜ˆå€¼ã€ç¦»çº¿ã€é”™è¯¯ï¼‰
- å¤šæ¸ é“é€šçŸ¥ï¼ˆé‚®ä»¶ã€Webhookã€ä¼ä¸šå¾®ä¿¡ã€é’‰é’‰ï¼‰

**backup/** - å¤‡ä»½ç³»ç»Ÿ
- è‡ªåŠ¨å®šæ—¶å¤‡ä»½
- é…ç½®å’Œæ•°æ®åº“å¤‡ä»½
- å¤‡ä»½æ¢å¤åŠŸèƒ½

**cluster/** - é›†ç¾¤ç®¡ç†
- ä¸»ä»æ¶æ„æ”¯æŒ
- è´Ÿè½½å‡è¡¡
- æ•…éšœè½¬ç§»

**config/** - é…ç½®ç®¡ç†
- ç³»ç»Ÿé…ç½®
- æ•°æ®åº“é…ç½®
- é›†ç¾¤é…ç½®

**database/** - æ•°æ®åº“å±‚
- å¤šæ•°æ®åº“æ”¯æŒï¼ˆSQLiteã€MySQLã€PostgreSQLã€Redisï¼‰
- ç»Ÿä¸€çš„æ•°æ®è®¿é—®æ¥å£
- æ•°æ®åº“é€‚é…å™¨æ¨¡å¼

**monitoring/** - ç›‘æ§ç³»ç»Ÿ
- Prometheus æŒ‡æ ‡å¯¼å‡º
- ç³»ç»Ÿæ€§èƒ½ç›‘æ§
- è®¾å¤‡çŠ¶æ€ç›‘æ§

**time/** - æ—¶é—´åŒæ­¥
- NTP å®¢æˆ·ç«¯
- NTP æœåŠ¡å™¨
- GPS æ—¶é—´åŒæ­¥æ”¯æŒ
- æ—¶é—´åŒæ­¥ç›‘æ§

**tools/** - å·¥å…·é›†
- è®¾å¤‡æ‰¹é‡åˆå§‹åŒ–
- æ•°æ®å¯¼å…¥å¯¼å‡º
- ç³»ç»Ÿç»´æŠ¤å·¥å…·

### å‰ç«¯æ–‡ä»¶ (public/)

- **index.html**: ä¸»ç•Œé¢ï¼ŒåŒ…å«è®¾å¤‡ç®¡ç†ã€æ•°æ®ç›‘æ§ã€æ‹“æ‰‘å›¾ç­‰
- **app.js**: å‰ç«¯é€»è¾‘ï¼Œå¤„ç†ç”¨æˆ·äº¤äº’å’Œæ•°æ®å±•ç¤º
- **style.css**: ç•Œé¢æ ·å¼
- **device-initializer.html**: è®¾å¤‡æ‰¹é‡åˆå§‹åŒ–å·¥å…·é¡µé¢

### æ–‡æ¡£ (docs/)

è¯¦ç»†çš„ä½¿ç”¨æ–‡æ¡£å’Œå¼€å‘æ–‡æ¡£ï¼ŒåŒ…æ‹¬ï¼š
- å¿«é€Ÿå¼€å§‹æŒ‡å—
- åŠŸèƒ½ä½¿ç”¨æŒ‡å—
- éƒ¨ç½²æŒ‡å—
- API æ–‡æ¡£
- æ•…éšœæ’é™¤

### è„šæœ¬ (scripts/)

å„ç§è‡ªåŠ¨åŒ–è„šæœ¬ï¼š
- ç³»ç»ŸæœåŠ¡å®‰è£…/å¸è½½
- æ•°æ®åº“å¤‡ä»½/æ¢å¤
- é›†ç¾¤éƒ¨ç½²
- æ•°æ®åº“åˆ‡æ¢

## ğŸš€ å¯åŠ¨æ–¹å¼

### å¼€å‘æ¨¡å¼
```bash
npm run dev
```

### ç”Ÿäº§æ¨¡å¼
```bash
npm start
```

### Docker æ¨¡å¼
```bash
make start
```

### ç³»ç»ŸæœåŠ¡
```bash
# Windows
scripts\windows\install-service.bat

# Linux
sudo bash scripts/linux/install-service.sh
```

## ğŸ“¦ ä¾èµ–è¯´æ˜

### æ ¸å¿ƒä¾èµ–
- **express**: Web æ¡†æ¶
- **ws**: WebSocket æ”¯æŒ
- **modbus-serial**: Modbus é€šä¿¡
- **serialport**: ä¸²å£é€šä¿¡

### æ•°æ®åº“
- **sql.js**: SQLiteï¼ˆé»˜è®¤ï¼‰
- **mysql2**: MySQL æ”¯æŒ
- **pg**: PostgreSQL æ”¯æŒ
- **ioredis**: Redis æ”¯æŒ

### ç›‘æ§
- **prom-client**: Prometheus å®¢æˆ·ç«¯
- **systeminformation**: ç³»ç»Ÿä¿¡æ¯é‡‡é›†

### å…¶ä»–
- **dotenv**: ç¯å¢ƒå˜é‡ç®¡ç†
- **nodemailer**: é‚®ä»¶å‘é€
- **axios**: HTTP å®¢æˆ·ç«¯
- **multer**: æ–‡ä»¶ä¸Šä¼ 

## ğŸ”§ é…ç½®æ–‡ä»¶

### ç¯å¢ƒå˜é‡ (.env)
```env
PORT=3000
NODE_ENV=production
DB_TYPE=sqlite
```

### æ•°æ®åº“é…ç½® (src/config/database.config.js)
é…ç½®ä¸åŒæ•°æ®åº“çš„è¿æ¥å‚æ•°

### é›†ç¾¤é…ç½® (src/config/cluster.config.js)
é…ç½®é›†ç¾¤æ¨¡å¼çš„èŠ‚ç‚¹ä¿¡æ¯

### ç³»ç»Ÿé…ç½® (src/config/system.config.js)
é…ç½®ç³»ç»Ÿçº§åˆ«çš„å‚æ•°

## ğŸ“Š æ•°æ®å­˜å‚¨

### SQLiteï¼ˆé»˜è®¤ï¼‰
- æ–‡ä»¶: `modbus.db`
- é€‚åˆ: å•æœºéƒ¨ç½²ã€å°è§„æ¨¡åº”ç”¨

### MySQL
- é€‚åˆ: ä¸­å¤§è§„æ¨¡åº”ç”¨ã€éœ€è¦é«˜å¯ç”¨

### PostgreSQL
- é€‚åˆ: å¤§è§„æ¨¡åº”ç”¨ã€å¤æ‚æŸ¥è¯¢

### Redis
- ç”¨é€”: ç¼“å­˜ã€ä¼šè¯å­˜å‚¨ã€é›†ç¾¤é€šä¿¡

## ğŸ”„ ç‰ˆæœ¬æ›´æ–°

### v2.0.0 (2024-12-02)
- âœ… é‡æ„é¡¹ç›®ç»“æ„ï¼Œä»£ç ç§»è‡³ src/ ç›®å½•
- âœ… æ·»åŠ ä½ç½®ç®¡ç†åŠŸèƒ½
- âœ… ä¼˜åŒ–å‰ç«¯ç•Œé¢å¸ƒå±€
- âœ… æ›´æ–°æ‰€æœ‰å¯åŠ¨è„šæœ¬å’Œé…ç½®

### v1.0.0
- åˆå§‹ç‰ˆæœ¬

---

**æ³¨æ„**: æœ¬æ–‡æ¡£æè¿°çš„æ˜¯é‡æ„åçš„é¡¹ç›®ç»“æ„ï¼ˆv2.0.0+ï¼‰ã€‚å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯æ—§ç‰ˆæœ¬ï¼Œè¯·å‚è€ƒ `docs/PROJECT_STRUCTURE.md`ã€‚
