# Arduino Modbus RS485 温湿度传感器读取程序

## 项目概述

这个程序用于在Arduino上通过RS485通信协议读取Modbus温湿度传感器的数据。支持多个传感器，可配置读取间隔和传感器参数。

## 硬件需求

1. Arduino开发板（如Arduino Uno、Arduino Mega等）
2. RS485模块（如MAX485模块）
3. Modbus RTU协议的温湿度传感器（如SHT20 Modbus模块、DHT22 Modbus模块等）
4. 杜邦线若干
5. 面包板（可选）

## 软件需求

1. Arduino IDE（版本1.8.0及以上）
2. ModbusMaster库

## 库安装

在Arduino IDE中安装ModbusMaster库：

1. 打开Arduino IDE
2. 点击「工具」→「管理库...」
3. 在搜索框中输入「ModbusMaster」
4. 选择合适的版本安装

## 接线说明

### Arduino与RS485模块的连接

| Arduino引脚 | RS485模块引脚 | 说明 |
|------------|--------------|------|
| TX (1)     | DI           | 数据输入 |
| RX (0)     | RO           | 数据输出 |
| 5V         | VCC          | 电源正极 |
| GND        | GND          | 电源负极 |
| 2          | DE           | 发送使能 |
| 3          | RE           | 接收使能 |

### RS485模块与传感器的连接

| RS485模块引脚 | 传感器引脚 | 说明 |
|--------------|------------|------|
| A            | A           | 总线A |
| B            | B           | 总线B |

## 配置说明

### 主配置文件 (config.h)

`config.h`文件包含了程序的主要配置参数：

- `SERIAL_BAUD`: 串口波特率，默认9600
- `READ_INTERVAL`: 读取间隔，单位毫秒，默认10000（10秒）
- `SENSOR_COUNT`: 传感器数量，默认2
- `DE_PIN`和`RE_PIN`: RS485控制引脚，默认分别为2和3

### 传感器配置文件 (sensors.h)

`sensors.h`文件包含了所有传感器的配置：

```cpp
SensorConfig sensors[SENSOR_COUNT] = {
  {1, 0x0000, 0x0001, "Sensor1"},
  {2, 0x0000, 0x0001, "Sensor2"}
};
```

每个传感器配置包括：
- `slaveId`: 传感器的Modbus从机ID
- `tempRegister`: 温度寄存器地址
- `humRegister`: 湿度寄存器地址
- `name`: 传感器名称

## 上传和运行

1. 将Arduino开发板通过USB线连接到电脑
2. 在Arduino IDE中打开`modbus.ino`文件
3. 选择正确的开发板和端口
4. 点击「上传」按钮将程序上传到Arduino
5. 打开串口监视器（波特率9600）查看传感器数据

## 数据格式

程序将在串口监视器中输出以下格式的数据：

```
传感器: Sensor1, 从机ID: 1, 温度: 25.5°C, 湿度: 60.2%
传感器: Sensor2, 从机ID: 2, 温度: 26.1°C, 湿度: 58.7%
```

## 故障排除

1. **无数据输出**
   - 检查RS485模块与Arduino的连接是否正确
   - 检查RS485模块与传感器的连接是否正确
   - 确认传感器的从机ID配置正确

2. **读取错误**
   - 检查串口波特率是否与传感器一致
   - 确认寄存器地址配置正确
   - 检查传感器是否支持Modbus RTU协议

3. **不稳定的读取**
   - 确保RS485总线的终端电阻正确连接（通常为120Ω）
   - 减少总线长度或增加信号放大器
   - 检查电源稳定性

## 扩展功能

程序支持以下扩展功能：

1. **增加传感器数量**：修改`SENSOR_COUNT`并在`sensors.h`中添加更多传感器配置
2. **修改读取间隔**：修改`READ_INTERVAL`参数
3. **添加数据存储**：可以连接SD卡模块将数据保存到SD卡
4. **添加网络功能**：可以使用Ethernet或WiFi模块将数据发送到服务器

## 注意事项

1. 确保RS485总线上的所有设备使用相同的波特率和奇偶校验
2. 总线上的设备数量不应超过32个
3. 长时间运行时注意Arduino的电源稳定性
4. 避免将RS485总线与强电线路并行敷设

## 版本历史

- v1.0: 初始版本，支持基本的Modbus传感器读取功能

## 许可证

本项目采用MIT许可证，详见LICENSE文件。
