# 集群监控快速开始

## 5分钟快速查看集群状态

### 前提条件

- 已部署集群模式（至少2个节点）
- Redis服务正常运行
- 所有节点已启动

### 步骤1: 访问系统监控页面

1. 打开浏览器访问任意节点
   ```
   http://节点IP:3000
   ```

2. 点击"系统监控"标签页

### 步骤2: 查看集群状态

在页面顶部可以看到集群状态概览：

```
┌─────────────┬─────────────┬─────────────┬─────────────┐
│  运行模式   │  活动节点   │  当前节点   │  任务总数   │
│  集群模式   │     3       │  node-1     │     10      │
└─────────────┴─────────────┴─────────────┴─────────────┘
```

### 步骤3: 检查节点健康状态

在"节点列表"表格中查看所有节点：

| 节点ID | 角色 | 主机名 | CPU核心 | 内存 | 负载 | 运行时间 | 最后心跳 | 状态 |
|--------|------|--------|---------|------|------|----------|----------|------|
| master-1 | 主节点 | server-1 | 8 | 16GB | 0.5 | 2天 | 刚刚 | 健康 |
| worker-1 | 工作节点 | server-2 | 4 | 8GB | 1.2 | 2天 | 刚刚 | 健康 |
| worker-2 | 工作节点 | server-3 | 4 | 8GB | 0.8 | 2天 | 刚刚 | 健康 |

**健康检查要点**：
- ✅ 所有节点状态为"健康"（绿色）
- ✅ 最后心跳时间在30秒内
- ✅ 负载值合理（< 2.0）
- ✅ 内存充足

### 步骤4: 查看任务分配

在"任务分配"区域查看任务分布：

```
worker-1  ████████████████████ 50%  (5个任务)
worker-2  ████████████████████ 50%  (5个任务)
```

**分配检查要点**：
- ✅ 任务分布相对均衡
- ✅ 没有节点负载过重
- ✅ 所有工作节点都有任务

### 步骤5: 刷新监控数据

点击"刷新"按钮更新监控数据，建议每分钟刷新一次。

## 常见问题快速排查

### 问题1: 看不到集群状态区域

**原因**: 系统运行在单机模式

**解决**:
1. 检查 `config/cluster.config.js` 中 `enabled: true`
2. 确认 Redis 服务正常运行
3. 重启节点

### 问题2: 节点显示为"异常"

**原因**: 节点心跳超时

**解决**:
1. 检查节点进程是否运行
   ```bash
   # Linux
   ps aux | grep node
   
   # Windows
   tasklist | findstr node
   ```

2. 检查网络连接
   ```bash
   ping 节点IP
   ```

3. 查看节点日志
   ```bash
   # 如果使用系统服务
   npm run logs
   ```

### 问题3: 任务分配不均

**原因**: 任务分配策略不合适

**解决**:
1. 编辑 `config/cluster.config.js`
2. 修改任务分配策略为 `least-loaded`
   ```javascript
   taskAllocation: {
     strategy: 'least-loaded'
   }
   ```
3. 重启所有节点

### 问题4: 节点数量不对

**原因**: 某些节点未正常启动

**解决**:
1. 检查所有节点是否启动
2. 查看节点启动日志
3. 确认 Redis 连接正常

## 监控最佳实践

### 1. 定期检查（推荐频率）

- **每小时**: 快速查看集群状态
- **每天**: 详细检查节点健康和任务分配
- **每周**: 分析负载趋势，优化配置

### 2. 关键指标

重点关注以下指标：

| 指标 | 正常范围 | 警告阈值 | 严重阈值 |
|------|----------|----------|----------|
| 节点状态 | 健康 | - | 异常 |
| CPU负载 | < 1.0 | 1.0-2.0 | > 2.0 |
| 内存使用 | < 70% | 70-85% | > 85% |
| 心跳延迟 | < 5秒 | 5-30秒 | > 30秒 |

### 3. 告警配置

建议配置以下告警：

1. **节点离线告警**
   - 当节点状态变为"异常"时发送通知

2. **负载过高告警**
   - 当节点负载 > 2.0 时发送通知

3. **内存不足告警**
   - 当可用内存 < 2GB 时发送通知

### 4. 日常维护

- 定期清理日志文件
- 监控磁盘空间
- 更新系统和依赖
- 备份配置文件

## 下一步

- 查看完整文档: [集群监控指南](docs/CLUSTER_MONITORING_GUIDE.md)
- 优化集群配置: [集群部署指南](docs/CLUSTER_GUIDE.md)
- 配置告警通知: [告警管理指南](docs/ALARM_GUIDE.md)

## 技术支持

遇到问题？

1. 查看节点日志
2. 检查 Redis 连接
3. 参考完整文档
4. 提交 Issue

---

**提示**: 集群监控功能在单机模式下不可见，需要启用集群模式才能使用。
