# 时间设置使用指南

## 功能概述

时间设置功能允许您配置系统的时区、时间格式和日期格式，确保系统显示的时间符合您的地区和使用习惯。

## 访问时间设置

1. 点击页面右上角的 **⚙️ 设置按钮**
2. 在系统设置对话框中，向下滚动到 **"时间设置"** 部分

## 配置选项

### 1. 时区设置

选择系统使用的时区，影响所有时间显示。

#### 支持的时区

**亚洲地区**:
- 中国标准时间 (UTC+8) - Asia/Shanghai
- 日本标准时间 (UTC+9) - Asia/Tokyo
- 韩国标准时间 (UTC+9) - Asia/Seoul
- 香港时间 (UTC+8) - Asia/Hong_Kong
- 新加坡时间 (UTC+8) - Asia/Singapore
- 曼谷时间 (UTC+7) - Asia/Bangkok
- 迪拜时间 (UTC+4) - Asia/Dubai

**欧洲地区**:
- 伦敦时间 (UTC+0) - Europe/London
- 巴黎时间 (UTC+1) - Europe/Paris
- 柏林时间 (UTC+1) - Europe/Berlin
- 莫斯科时间 (UTC+3) - Europe/Moscow

**美洲地区**:
- 纽约时间 (UTC-5) - America/New_York
- 芝加哥时间 (UTC-6) - America/Chicago
- 洛杉矶时间 (UTC-8) - America/Los_Angeles
- 多伦多时间 (UTC-5) - America/Toronto

**大洋洲地区**:
- 悉尼时间 (UTC+10) - Australia/Sydney
- 奥克兰时间 (UTC+12) - Pacific/Auckland

**其他**:
- 协调世界时 (UTC+0) - UTC

#### 时区影响范围

时区设置会影响以下内容的时间显示：
- 数据采集时间戳
- 告警触发时间
- 系统日志时间
- 图表时间轴
- 备份创建时间
- 节点心跳时间

### 2. 时间格式

选择时间的显示格式。

#### 24小时制
- **格式**: 23:59:59
- **说明**: 使用0-23表示小时
- **适用**: 中国、欧洲大部分地区
- **示例**: 14:30:00

#### 12小时制
- **格式**: 11:59:59 PM
- **说明**: 使用1-12表示小时，加上AM/PM
- **适用**: 美国、加拿大等地区
- **示例**: 2:30:00 PM

### 3. 日期格式

选择日期的显示格式。

#### 年-月-日 (YYYY-MM-DD)
- **示例**: 2024-12-01
- **说明**: ISO 8601 标准格式
- **适用**: 国际通用，中国常用
- **优点**: 排序友好

#### 月/日/年 (MM/DD/YYYY)
- **示例**: 12/01/2024
- **说明**: 美式日期格式
- **适用**: 美国
- **优点**: 符合美国习惯

#### 日/月/年 (DD/MM/YYYY)
- **示例**: 01/12/2024
- **说明**: 欧式日期格式
- **适用**: 欧洲、澳大利亚等
- **优点**: 符合欧洲习惯

#### 中文格式 (YYYY年MM月DD日)
- **示例**: 2024年12月01日
- **说明**: 中文日期格式
- **适用**: 中国
- **优点**: 易读性好

### 4. 当前系统时间

实时显示根据所选设置格式化后的当前时间。

**功能**:
- 实时更新（每秒）
- 预览时间格式效果
- 验证时区设置

**用途**:
- 确认时区是否正确
- 预览时间格式
- 验证配置效果

### 5. 自动同步服务器时间

选择是否使用服务器时间。

#### 启用（推荐）
- 使用服务器时间
- 确保所有客户端时间一致
- 适合多用户环境

#### 禁用
- 使用浏览器本地时间
- 适合单用户环境
- 可能导致时间不一致

## 使用场景

### 场景1: 跨时区部署

**情况**: 服务器在北京，用户在纽约

**配置**:
```
时区: America/New_York (UTC-5)
时间格式: 12小时制
日期格式: MM/DD/YYYY
自动同步: 启用
```

**效果**: 所有时间显示为纽约当地时间

### 场景2: 国际团队协作

**情况**: 团队成员分布在不同国家

**配置**:
```
时区: UTC (协调世界时)
时间格式: 24小时制
日期格式: YYYY-MM-DD
自动同步: 启用
```

**效果**: 使用统一的UTC时间，避免混淆

### 场景3: 本地化部署

**情况**: 系统仅在中国使用

**配置**:
```
时区: Asia/Shanghai (UTC+8)
时间格式: 24小时制
日期格式: YYYY年MM月DD日
自动同步: 启用
```

**效果**: 符合中国用户习惯

### 场景4: 美国部署

**情况**: 系统在美国使用

**配置**:
```
时区: America/New_York (UTC-5)
时间格式: 12小时制
日期格式: MM/DD/YYYY
自动同步: 启用
```

**效果**: 符合美国用户习惯

## 保存设置

1. 配置完所有时间选项
2. 点击 **"保存设置"** 按钮
3. 系统提示"设置已保存，刷新页面后生效"
4. 刷新浏览器页面

## 注意事项

### 时区选择

✅ **推荐做法**:
- 选择与服务器所在地相同的时区
- 或选择用户所在地的时区
- 团队协作时使用UTC

❌ **避免**:
- 频繁更改时区
- 使用错误的时区
- 不同用户使用不同时区（除非必要）

### 时间格式

✅ **推荐做法**:
- 根据地区习惯选择
- 保持一致性
- 考虑用户习惯

❌ **避免**:
- 混用不同格式
- 使用不熟悉的格式

### 数据一致性

⚠️ **重要提示**:
- 时区设置不会改变数据库中存储的时间戳
- 只影响显示格式
- 历史数据会按新时区重新显示

### 服务器时间同步

✅ **推荐启用**:
- 多用户环境
- 需要时间一致性
- 分布式部署

⚠️ **可以禁用**:
- 单用户环境
- 本地测试
- 特殊需求

## 时间显示位置

时间设置会影响以下位置的时间显示：

1. **数据图表**
   - X轴时间标签
   - 数据点时间戳

2. **告警管理**
   - 告警触发时间
   - 告警恢复时间
   - 告警历史记录

3. **系统监控**
   - 节点最后心跳时间
   - 系统运行时间

4. **备份还原**
   - 备份创建时间
   - 备份文件列表

5. **设备管理**
   - 数据采集时间
   - 最后更新时间

## 技术说明

### 时间存储

- 数据库存储: Unix 时间戳（毫秒）
- 格式: 数字（如 1701234567890）
- 时区无关: 存储的是UTC时间

### 时间转换

- 前端转换: 使用 Intl.DateTimeFormat API
- 支持所有标准时区
- 自动处理夏令时

### 浏览器兼容性

- Chrome/Edge: ✅ 完全支持
- Firefox: ✅ 完全支持
- Safari: ✅ 完全支持
- IE11: ⚠️ 部分功能受限

## 故障排除

### 问题1: 时间显示不正确

**可能原因**:
- 时区设置错误
- 浏览器时间不准确
- 服务器时间不准确

**解决方法**:
1. 检查时区设置
2. 同步系统时间
3. 启用"自动同步服务器时间"

### 问题2: 时间格式未生效

**可能原因**:
- 未刷新页面
- 浏览器缓存

**解决方法**:
1. 刷新页面（F5）
2. 清除浏览器缓存
3. 硬刷新（Ctrl+F5）

### 问题3: 时区列表中没有需要的时区

**可能原因**:
- 时区未在列表中

**解决方法**:
1. 选择最接近的时区
2. 联系管理员添加时区
3. 使用UTC时区

### 问题4: 不同客户端时间不一致

**可能原因**:
- 未启用"自动同步服务器时间"
- 客户端本地时间不准确

**解决方法**:
1. 启用"自动同步服务器时间"
2. 同步所有客户端系统时间
3. 使用统一的时区设置

## 最佳实践

1. **统一时区**: 团队使用统一的时区设置
2. **启用同步**: 启用自动同步服务器时间
3. **标准格式**: 使用ISO 8601标准格式（YYYY-MM-DD）
4. **文档记录**: 记录时区设置，便于维护
5. **定期检查**: 定期检查时间显示是否正确

## 环境变量配置

也可以通过环境变量设置服务器时区：

```bash
# .env 文件
TZ=Asia/Shanghai
```

**注意**: 客户端时区设置优先级高于服务器时区。

## API 接口

### 获取服务器时间

```bash
GET /api/system/time
```

响应示例:
```json
{
  "serverTime": 1701234567890,
  "timezone": "Asia/Shanghai",
  "offset": -480
}
```

## 相关文档

- [系统设置指南](SYSTEM_SETTINGS_GUIDE.md)
- [快速开始](docs/QUICK_START.md)
- [系统监控](docs/CLUSTER_MONITORING_GUIDE.md)

## 技术支持

如遇问题：
1. 检查时区设置
2. 验证时间格式
3. 查看浏览器控制台
4. 参考本文档

---

**提示**: 时间设置会立即影响所有新显示的时间，但需要刷新页面才能更新已显示的时间。
