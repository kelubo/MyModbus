# 设备拓扑图使用指南

## 功能概述

设备拓扑图提供了可视化的设备网络结构展示，帮助您直观地了解设备的连接关系、状态和分布情况。

## 访问拓扑图

1. 登录系统后，点击顶部导航栏的 **"拓扑图"** 标签
2. 系统将自动加载并显示当前所有设备的拓扑结构

## 拓扑图元素

### 节点类型

#### 1. 服务器节点（中心节点）
- **图标**: 🖥️
- **颜色**: 绿色
- **位置**: 拓扑图中心
- **说明**: 代表 Modbus RTU Manager 服务器，负责管理所有设备

#### 2. 设备节点
- **RTU 设备图标**: 📡
- **TCP 设备图标**: 🌐
- **位置**: 围绕服务器节点分布
- **说明**: 代表各个 Modbus 设备

### 节点状态

节点颜色表示设备的当前状态：

| 颜色 | 状态 | 说明 |
|------|------|------|
| 🟢 绿色 | 在线 | 设备正常运行，无告警 |
| 🔴 红色 | 告警 | 设备触发告警（闪烁动画） |
| ⚪ 灰色 | 禁用 | 设备已被禁用 |
| ⚫ 深灰 | 离线 | 设备离线或无响应 |

### 连接线

连接线表示设备与服务器之间的通信链路：

- **蓝色虚线**: Modbus RTU 连接（串口）
- **绿色实线**: Modbus TCP 连接（网络）

## 交互操作

### 1. 查看节点详情

**操作**: 点击任意节点

**显示信息**:
- 设备名称
- 设备ID
- 从站ID
- 连接类型（RTU/TCP）
- 连接参数（串口/IP地址）
- 寄存器配置
- 采集间隔
- 当前状态

### 2. 拖拽视图

**操作**: 
- 在空白区域按住鼠标左键拖动
- 可以移动整个拓扑图

**用途**: 调整视图位置，查看不同区域

### 3. 缩放视图

**操作**: 
- 使用鼠标滚轮上下滚动
- 向上滚动：放大
- 向下滚动：缩小

**范围**: 0.5x - 2.0x

### 4. 刷新拓扑图

**操作**: 点击 **"刷新"** 按钮

**效果**: 
- 重新加载设备列表
- 更新设备状态
- 刷新告警信息

### 5. 自动布局

**操作**: 点击 **"自动布局"** 按钮

**效果**: 
- 自动重新排列设备节点
- 优化节点分布
- 避免节点重叠

### 6. 重置视图

**操作**: 点击 **"重置视图"** 按钮

**效果**: 
- 恢复默认缩放比例（1:1）
- 居中显示拓扑图

## 统计信息

拓扑图下方显示实时统计信息：

### 设备统计

- **总设备数**: 系统中配置的所有设备数量
- **在线设备**: 当前正常运行的设备数量
- **离线设备**: 当前离线或禁用的设备数量
- **告警设备**: 当前触发告警的设备数量

### 连接类型

- **RTU (串口)**: 使用串口连接的设备数量
- **TCP (网络)**: 使用网络连接的设备数量

## 使用场景

### 场景1: 快速了解系统状态

1. 打开拓扑图
2. 观察节点颜色
3. 识别告警设备（红色闪烁）
4. 查看设备分布

### 场景2: 排查设备问题

1. 发现红色告警节点
2. 点击节点查看详情
3. 记录设备信息
4. 切换到设备管理或告警管理进行处理

### 场景3: 规划设备部署

1. 查看当前设备分布
2. 识别 RTU 和 TCP 设备
3. 规划新设备的连接方式
4. 评估系统负载

### 场景4: 系统演示

1. 使用拓扑图向他人展示系统架构
2. 实时显示设备状态
3. 演示告警响应
4. 展示系统规模

## 拓扑图布局说明

### 默认布局

- **中心**: 服务器节点
- **内圈**: RTU 设备（半径 200px）
- **外圈**: TCP 设备（半径 250px）
- **分布**: 均匀分布在圆周上

### 自动布局算法

系统使用圆形布局算法：
1. 计算设备总数
2. 按角度均匀分布
3. 根据连接类型调整半径
4. 避免节点重叠

## 最佳实践

### 1. 定期查看

- **建议频率**: 每天至少查看一次
- **重点关注**: 告警设备（红色节点）
- **操作**: 及时处理异常设备

### 2. 合理命名

- 使用清晰的设备名称
- 包含位置或功能信息
- 便于在拓扑图中识别

**示例**:
- ✅ "车间A-温度传感器01"
- ✅ "生产线B-压力监测"
- ❌ "设备1"
- ❌ "test"

### 3. 状态监控

- 关注设备状态变化
- 记录频繁告警的设备
- 分析设备故障模式

### 4. 文档记录

- 截图保存拓扑结构
- 记录设备连接关系
- 建立设备档案

## 技术说明

### 渲染技术

- 使用 SVG 绘制拓扑图
- 支持矢量缩放
- 流畅的动画效果

### 性能优化

- 智能节点布局
- 按需渲染
- 事件委托

### 浏览器兼容性

- Chrome/Edge: ✅ 完全支持
- Firefox: ✅ 完全支持
- Safari: ✅ 完全支持
- IE11: ⚠️ 部分功能受限

## 故障排除

### 问题1: 拓扑图不显示

**可能原因**:
- 没有配置设备
- 浏览器不支持 SVG

**解决方法**:
1. 检查是否已添加设备
2. 更新浏览器到最新版本
3. 刷新页面

### 问题2: 节点重叠

**可能原因**:
- 设备数量过多
- 布局算法需要优化

**解决方法**:
1. 点击"自动布局"按钮
2. 手动缩小视图
3. 减少同时显示的设备

### 问题3: 状态不更新

**可能原因**:
- 未刷新拓扑图
- 数据采集未启动

**解决方法**:
1. 点击"刷新"按钮
2. 确认数据采集已启动
3. 检查设备连接

### 问题4: 无法拖拽

**可能原因**:
- 浏览器兼容性问题
- JavaScript 错误

**解决方法**:
1. 检查浏览器控制台错误
2. 刷新页面
3. 清除浏览器缓存

## 快捷键

目前拓扑图不支持快捷键操作，所有功能通过鼠标交互实现。

## 未来功能

计划中的功能增强：

- [ ] 节点拖拽重新定位
- [ ] 自定义节点图标
- [ ] 导出拓扑图为图片
- [ ] 历史拓扑快照
- [ ] 3D 拓扑视图
- [ ] 实时数据流动画
- [ ] 设备分组显示
- [ ] 自定义布局模板

## 相关文档

- [设备管理指南](docs/QUICK_START.md)
- [告警管理指南](docs/ALARM_GUIDE.md)
- [系统监控指南](docs/CLUSTER_MONITORING_GUIDE.md)

## 技术支持

如遇问题：
1. 查看浏览器控制台错误
2. 检查设备配置
3. 参考本文档
4. 联系技术支持

---

**提示**: 拓扑图会自动反映设备的实时状态，建议保持页面打开以监控设备变化。
